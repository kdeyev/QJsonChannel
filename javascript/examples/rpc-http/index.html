<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Rpc example</title>
    <script type="application/javascript" src="../../qjsonchannel/simple-jsonrpc-js/simple-jsonrpc-js.js"></script>
    <script type="application/javascript" src="../../qjsonchannel/qjsonchannel.js"></script>
</head>

<body>
<h1 class="title"></h1>
<p class="paragraph"></p>
<script>
        //configure
        var jrpc = new simple_jsonrpc();

        jrpc.toStream = function(_msg){
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (this.readyState != 4) return;

                try {
                    jrpc.messageHandler(this.responseText);
                }
                catch (e){
                    console.error(e);
                }
            };

            xhr.open("POST", 'http://localhost:5555', true);
            xhr.setRequestHeader('Content-type', 'application/json');
            xhr.send(_msg);
        };

 
        new RpcWebChannel(jrpc, function(services) {
            services.agent.testMethod().then(function (result) {
                document.getElementsByClassName('paragraph')[0].innerHTML += 'agent.testMethod result: ' + result + '<br>';
            });

            services.agent.testMethodWithParams("one", false, 10).then(function (result) {
                document.getElementsByClassName('paragraph')[0].innerHTML += 'agent.testMethodWithParams result: ' + result + '<br>';
            });

            services.agent.testMethodWithParamsAndReturnValue ("kostya").then(function (result) {
                document.getElementsByClassName('paragraph')[0].innerHTML += 'agent.testMethodWithParamsAndReturnValue result: ' + result + '<br>';
            });
        });

</script>
</body>

</html>