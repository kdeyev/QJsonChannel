<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Rpc example</title>
    <script type="application/javascript" src="../../qjsonchannel/simple-jsonrpc-js/simple-jsonrpc-js.js"></script>
</head>

<body>
<h1 class="title"></h1>
<p class="paragraph"></p>
<script>
        //configure
        var jrpc = new simple_jsonrpc();

        //set a communication function
        jrpc.toStream = function(_msg){
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (this.readyState != 4) return;

                try {
                    jrpc.messageHandler(this.responseText);
                }
                catch (e){
                    console.error(e);
                }
            };

            xhr.open("POST", 'http://localhost:5555', true);
            xhr.setRequestHeader('Content-type', 'application/json');
            xhr.send(_msg);
        };

        //
        // Slots calls
        //
        jrpc.call("object.slot").then(function (result) {
            document.getElementsByClassName('paragraph')[0].innerHTML += 'object.slot result: ' + result + '<br>';
        });

        jrpc.call('object.slotWithParams', ["one", false, 10]).then(function (result) {
            document.getElementsByClassName('paragraph')[0].innerHTML += 'object.slotWithParams result: ' + result + '<br>';
        });

        jrpc.call('object.slotWithParamsAndReturnValue', ["kostya"]).then(function (result) {
            document.getElementsByClassName('paragraph')[0].innerHTML += 'object.slotWithParamsAndReturnValue result: ' + result + '<br>';
        });

        // Invokable maethods calls
        jrpc.call('object.invokableSetter', ["I'm setter"]).then(function (result) {
            document.getElementsByClassName('paragraph')[0].innerHTML += 'object.invokableSetter result: ' + result + '<br>';
        
            // call Getter as function call
            jrpc.call('object.invokableGetter', []).then(function (result) {
                document.getElementsByClassName('paragraph')[0].innerHTML += 'object.invokableGetter    result: ' + result + '<br>';
            });
        });

        // Properties access 
        jrpc.call('object.setProperty', ["I'm setter"]).then(function (result) {
            document.getElementsByClassName('paragraph')[0].innerHTML += 'object.setProperty result: ' + result + '<br>';
        
            // call Getter as function call
            jrpc.call('object.getProperty', []).then(function (result) {
                document.getElementsByClassName('paragraph')[0].innerHTML += 'object.getProperty    result: ' + result + '<br>';
            });
        });

</script>
</body>

</html>