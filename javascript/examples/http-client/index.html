<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Rpc example</title>
    <script type="application/javascript" src="../../qjsonchannel/simple-jsonrpc-js/simple-jsonrpc-js.js"></script>
</head>

<body>
<h1 class="title"></h1>
<p class="paragraph"></p>
<script>
        //configure
        var jrpc = new simple_jsonrpc();

        //set a communication function
        jrpc.toStream = function(_msg){
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (this.readyState != 4) return;

                try {
                    jrpc.messageHandler(this.responseText);
                }
                catch (e){
                    console.error(e);
                }
            };

            xhr.open("POST", 'http://localhost:5555', true);
            xhr.setRequestHeader('Content-type', 'application/json');
            xhr.send(_msg);
        };

        //calls
        jrpc.call("object.testMethod").then(function (result) {
            document.getElementsByClassName('paragraph')[0].innerHTML += 'object.testMethod result: ' + result + '<br>';
        });

        jrpc.call('object.testMethodWithParams', ["one", false, 10]).then(function (result) {
            document.getElementsByClassName('paragraph')[0].innerHTML += 'object.testMethodWithParams result: ' + result + '<br>';
        });

        jrpc.call('object.testMethodWithParamsAndReturnValue', ["kostya"]).then(function (result) {
            document.getElementsByClassName('paragraph')[0].innerHTML += 'object.testMethodWithParamsAndReturnValue result: ' + result + '<br>';
        });

</script>
</body>

</html>